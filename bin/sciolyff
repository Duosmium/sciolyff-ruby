#!/usr/bin/env ruby
# frozen_string_literal: true

require 'optimist'
require 'yaml'
require_relative '../lib/sciolyff_tester.rb'

Optimist.options do
  version 'sciolyff 0.1.0'
  banner <<~STRING
    Checks if a given file is in the Scioly File Format

    Usage:
            bin/#{File.basename(__FILE__)} [options] <file>

    where [options] are:
  STRING
end

if ARGV.first.nil? || !File.exist?(ARGV.first)
  puts "Error: file '#{ARGV.first}' not found."
  puts 'Try --help for help.'
  exit
end

begin
  file = File.read(ARGV.first)
  $rep = YAML.load(file)
rescue StandardError => exception
  puts 'Error: could not read file as YAML.'
  warn exception.message
  exit
end

puts 'More than one file given, ignoring all but first.' if ARGV.length > 1

puts <<~STRING
  Validating file with Minitest...

  Overkill? Probably.
  Doesn't give line numbers from original file? Yeah.

STRING

Minitest.run
